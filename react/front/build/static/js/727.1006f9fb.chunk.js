"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[727],{5727:function(e,r,n){n.r(r),n.d(r,{SeparateAudioVideoHandler:function(){return m},default:function(){return d}});var t=n(885),a=n(5861),o=n(8214),u=n(6420),c=n(608),s=n(5459),i=n.n(s),f=n(2791),l=n(184);function d(e){var r=e.videoInfo,n=e.audio,t=e.onLoadingComplete;return null!==r&&void 0!==r&&r.hasAudio||!n||!("MediaSource"in window)?(console.log("all in one"),(0,l.jsx)("video",{className:"max-h-full max-w-full",controls:!0,autoPlay:!0,muted:!0,loop:!0,preload:"auto",playsInline:!0,draggable:!1,onLoadStart:t,children:(0,l.jsx)("source",{"data-src":r.url,src:r.url,type:"video/mp4"})})):(console.log("separate audio"),(0,l.jsx)(m,{videoUrl:r.url,audioUrl:n,onLoadingComplete:t}))}function p(e){return v.apply(this,arguments)}function v(){return(v=(0,c.Z)((0,o.Z)().mark((function e(r){var n,t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,u.Z)(fetch(r).then((function(e){if(null===(null===e||void 0===e?void 0:e.body))throw new Error("response null, no video");return e.body.getReader()})));case 3:n=e.sent;case 4:return e.next=7,(0,u.Z)(n.read());case 7:if(!(t=e.sent).done){e.next=10;break}return e.abrupt("break",14);case 10:return e.next=12,t.value;case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error(e.t0);case 19:return e.abrupt("return");case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function x(e){var r=i().mp4.probe.tracks(e)[0].codec;return'video/mp4; codecs="'.concat(r,'"')}function b(e){return h.apply(this,arguments)}function h(){return(h=(0,a.Z)((0,o.Z)().mark((function e(r){var n,t,a,u;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(r);case 3:return e.next=5,e.sent.blob();case 5:return n=e.sent,e.next=8,n.arrayBuffer();case 8:if(t=e.sent,a=new Int8Array(t),u=x(a),MediaSource.isTypeSupported(u)){e.next=13;break}throw new Error("Unsupported MIME type or codec: ".concat(u));case 13:return e.abrupt("return",{arrayBuffer:t,mimeCodec:u});case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",{error:e.t0});case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function m(e){var r=e.videoUrl,n=e.audioUrl,u=e.onLoadingComplete,c=(0,f.useRef)(null),s=(0,f.useState)(!1),i=(0,t.Z)(s,2),d=i[0],v=i[1];return(0,f.useEffect)((function(){var e;d&&(null===(e=c.current)||void 0===e||e.play())}),[d]),(0,f.useEffect)((function(){function e(){return e=(0,a.Z)((0,o.Z)().mark((function e(){var t,s,i,f,l,d,h,m,w;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==c.current){e.next=3;break}return console.error("videoRef not set"),e.abrupt("return");case 3:return t=new MediaSource,s=p(r),e.next=7,s.next();case 7:return i=e.sent,f=!0,t.addEventListener("sourceopen",(0,a.Z)((0,o.Z)().mark((function e(){var r,n,c;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.done){e.next=2;break}throw new Error("no first segment");case 2:r=x(i.value),n=t.addSourceBuffer(r),c=function(){var e=(0,a.Z)((0,o.Z)().mark((function e(){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:(r=e.sent).done?t.endOfStream():n.appendBuffer(r.value.buffer),f&&(f=!1,u(),v(!0));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n.addEventListener("updateend",c),n.appendBuffer(i.value.buffer);case 7:case"end":return e.stop()}}),e)})))),e.next=12,b(n);case 12:l=e.sent,d=l.arrayBuffer,h=l.mimeCodec,(m=l.error)?console.error(m):t.addEventListener("sourceopen",(function(){var e=t.addSourceBuffer(h);e.addEventListener("updateend",(function(){})),e.appendBuffer(d)})),w=URL.createObjectURL(t),c.current.src=URL.createObjectURL(t),URL.revokeObjectURL(w);case 18:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,r,u]),(0,l.jsx)("video",{className:"max-h-full max-w-full ".concat(d?"":"invisible"),ref:c,controls:!0,autoPlay:!1,muted:!0,loop:!0,preload:"auto",playsInline:!0,draggable:!1})}}}]);
//# sourceMappingURL=727.1006f9fb.chunk.js.map